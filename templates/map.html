{% extends "base.html" %}

{% block content %}
<h1>Temperature Map</h1>
<div id="map" style="height: 500px;"></div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

<script>
    var map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    function getColor(temperature) {
        return temperature > 90 ? '#FF0000' :
               temperature > 80 ? '#FF3300' :
               temperature > 70 ? '#FF6600' :
               temperature > 60 ? '#FF9900' :
               temperature > 50 ? '#FFCC00' :
               temperature > 40 ? '#FFFF00' :
               temperature > 30 ? '#CCFF00' :
               temperature > 20 ? '#99FF00' :
               temperature > 10 ? '#66FF00' :
                                  '#33FF00';
    }

    map.on('click', function(e) {
        fetch(`/get_temperature_data?lat=${e.latlng.lat}&lon=${e.latlng.lng}`)
            .then(response => response.json())
            .then(data => {
                if (data.temperature) {
                    L.circle(e.latlng, {
                        color: getColor(data.temperature),
                        fillColor: getColor(data.temperature),
                        fillOpacity: 0.5,
                        radius: 50000
                    }).addTo(map).bindPopup(`Temperature: ${data.temperature.toFixed(1)}°F`);
                }
            });
    });
</script>

<div class="navigation" style="margin-top: 20px; text-align: center;">
    <a href="{{ url_for('home') }}" style="margin: 0 10px; text-decoration: none; color: #007bff;">Home</a> |
    <a href="{{ url_for('search') }}" style="margin: 0 10px; text-decoration: none; color: #007bff;">Search</a> |
    <a href="{{ url_for('forecast') }}" style="margin: 0 10px; text-decoration: none; color: #007bff;">Forecast</a>
</div>
{% endblock %}